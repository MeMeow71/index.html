<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; }
        .container { text-align: center; max-width: 500px; width: 100%; background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; backdrop-filter: blur(10px); }
        h1 { margin-bottom: 20px; font-size: 2.5rem; }
        .status { font-size: 1.3rem; margin: 20px 0; font-weight: bold; }
        .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 20px auto; max-width: 330px; }
        .cell { aspect-ratio: 1; background: rgba(255,255,255,0.15); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .cell:hover { background: rgba(255,255,255,0.25); transform: translateY(-2px); }
        .cell.x { color: #ff6b6b; }
        .cell.o { color: #51cf66; }
        .controls { margin: 25px 0; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        button { padding: 12px 20px; background: #ffa502; color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        button:hover { background: #ff7f00; transform: translateY(-2px); }
        input { padding: 12px; border: none; border-radius: 8px; font-size: 1rem; width: 180px; }
        .player-info { display: flex; justify-content: space-around; margin: 15px 0; font-size: 1.1rem; }
        .winning-cell { background: rgba(255, 215, 0, 0.3) !important; border-color: gold !important; animation: pulse 1s infinite; }
        @keyframes pulse { 
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .connection { margin: 10px 0; padding: 8px; border-radius: 5px; background: rgba(46, 213, 115, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏ ONLINE</h1>
        
        <div class="status" id="status">–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É –¥–ª—è –∏–≥—Ä—ã</div>
        
        <div class="player-info">
            <div>‚ùå <span id="playerX">–û–∂–∏–¥–∞–Ω–∏–µ...</span></div>
            <div>‚≠ïÔ∏è <span id="playerO">–û–∂–∏–¥–∞–Ω–∏–µ...</span></div>
        </div>
        
        <div class="connection" id="connection">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: –û–∂–∏–¥–∞–Ω–∏–µ</div>
        
        <div class="board" id="board"></div>
        
        <div class="controls">
            <input type="text" id="roomInput" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã">
            <button onclick="createRoom()">üÜï –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <button onclick="joinRoom()">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button onclick="copyLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <button onclick="newGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>

    <!-- üî• Firebase SDK - –¢–û–ß–ù–û –¢–ê–ö –ö–ê–ö –ü–û–ö–ê–ó–´–í–ê–ï–¢ FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // üîß üîß üîß –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –í–ê–®–£ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Æ –ò–ó FIREBASE üîß üîß üîß
        const firebaseConfig = {
            apiKey: "–í–ê–®_API_KEY",
            authDomain: "–í–ê–®_AUTH_DOMAIN",
            databaseURL: "–í–ê–®_DATABASE_URL",
            projectId: "–í–ê–®_PROJECT_ID",
            storageBucket: "–í–ê–®_STORAGE_BUCKET",
            messagingSenderId: "–í–ê–®_SENDER_ID",
            appId: "–í–ê–®_APP_ID"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let currentRoom = null;
        let playerId = 'player_' + Math.random().toString(36).substr(2, 9);
        let playerSymbol = null;
        let isMyTurn = false;

        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
        function createBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.setAttribute('data-index', i);
                cell.addEventListener('click', () => makeMove(i));
                board.appendChild(cell);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        function createRoom() {
            const roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
            document.getElementById('roomInput').value = roomId;
            joinRoom(roomId, true);
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const roomId = document.getElementById('roomInput').value.trim().toUpperCase();
            if (!roomId) return alert('–í–≤–µ–¥–∏—Ç–µ ID –∫–æ–º–Ω–∞—Ç—ã');
            joinRoom(roomId, false);
        }

        function joinRoom(roomId, isCreator) {
            const roomRef = database.ref('rooms/' + roomId);
            
            roomRef.once('value').then(snapshot => {
                if (!snapshot.exists() && !isCreator) {
                    return alert('–ö–æ–º–Ω–∞—Ç–∞ ' + roomId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }

                currentRoom = roomId;
                document.getElementById('connection').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...';

                if (!snapshot.exists()) {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É
                    roomRef.set({
                        players: { 
                            [playerId]: { symbol: 'X', name: '–ò–≥—Ä–æ–∫ 1', connected: true }
                        },
                        game: { 
                            board: ['','','','','','','','',''], 
                            currentPlayer: 'X', 
                            winner: null,
                            draw: false
                        },
                        createdAt: Date.now()
                    });
                    playerSymbol = 'X';
                    isMyTurn = true;
                    document.getElementById('status').textContent = '‚úÖ –í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ X - –í–∞—à —Ö–æ–¥!';
                } else {
                    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–Ω–∞—Ç–µ
                    const room = snapshot.val();
                    const players = room.players || {};
                    
                    if (Object.keys(players).length >= 2) {
                        return alert('–ö–æ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞! –ú–∞–∫—Å–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞.');
                    }

                    playerSymbol = 'O';
                    isMyTurn = false;
                    roomRef.child('players').update({
                        [playerId]: { symbol: 'O', name: '–ò–≥—Ä–æ–∫ 2', connected: true }
                    });
                    document.getElementById('status').textContent = '‚úÖ –í—ã –∏–≥—Ä–∞–µ—Ç–µ –∑–∞ O - –û–∂–∏–¥–∞–π—Ç–µ —Ö–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞';
                }

                // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç–µ
                setupRoomListeners(roomId);
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π –∫–æ–º–Ω–∞—Ç—ã
        function setupRoomListeners(roomId) {
            const roomRef = database.ref('rooms/' + roomId);
            
            roomRef.on('value', snapshot => {
                const room = snapshot.val();
                if (room) {
                    updateBoard(room.game.board);
                    updatePlayers(room.players);
                    updateGameStatus(room.game);
                    document.getElementById('connection').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                }
            });
        }

        // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        function makeMove(index) {
            if (!currentRoom || !isMyTurn) return;
            
            const gameRef = database.ref('rooms/' + currentRoom + '/game');
            gameRef.once('value').then(snapshot => {
                const game = snapshot.val();
                if (game && game.board[index] === '' && !game.winner) {
                    const newBoard = [...game.board];
                    newBoard[index] = playerSymbol;
                    
                    gameRef.update({
                        board: newBoard,
                        currentPlayer: playerSymbol === 'X' ? 'O' : 'X'
                    });
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏
        function updateBoard(board) {
            const cells = document.getElementById('board').children;
            for (let i = 0; i < 9; i++) {
                cells[i].textContent = board[i] || '';
                cells[i].className = 'cell';
                if (board[i]) cells[i].classList.add(board[i].toLowerCase());
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–æ–∫–∞—Ö
        function updatePlayers(players) {
            const playerX = Object.values(players).find(p => p.symbol === 'X');
            const playerO = Object.values(players).find(p => p.symbol === 'O');
            
            document.getElementById('playerX').textContent = playerX ? playerX.name : '–û–∂–∏–¥–∞–Ω–∏–µ...';
            document.getElementById('playerO').textContent = playerO ? playerO.name : '–û–∂–∏–¥–∞–Ω–∏–µ...';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä—ã
        function updateGameStatus(game) {
            const winner = checkWinner(game.board);
            isMyTurn = game.currentPlayer === playerSymbol && !winner;
            
            if (winner) {
                document.getElementById('status').textContent = winner === playerSymbol ? 
                    'üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏! –£—Ä–∞!' : 'üòû –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ!';
                highlightWinner(game.board, winner);
            } else if (game.board.every(cell => cell !== '')) {
                document.getElementById('status').textContent = 'ü§ù –ù–∏—á—å—è! –•–æ—Ä–æ—à–∞—è –∏–≥—Ä–∞!';
            } else {
                document.getElementById('status').textContent = isMyTurn ? 
                    '‚úÖ –í–∞—à —Ö–æ–¥! (' + playerSymbol + ')' : 
                    '‚è≥ –û–∂–∏–¥–∞–µ–º —Ö–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞...';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        function checkWinner(board) {
            const winPatterns = [
                [0,1,2], [3,4,5], [6,7,8], // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ
                [0,3,6], [1,4,7], [2,5,8], // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ
                [0,4,8], [2,4,6] // –¥–∏–∞–≥–æ–Ω–∞–ª—å–Ω—ã–µ
            ];
            
            for (const pattern of winPatterns) {
                const [a,b,c] = pattern;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return board[a];
                }
            }
            return null;
        }

        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        function highlightWinner(board, winner) {
            const winPatterns = [
                [0,1,2], [3,4,5], [6,7,8],
                [0,3,6], [1,4,7], [2,5,8],
                [0,4,8], [2,4,6]
            ];
            
            for (const pattern of winPatterns) {
                const [a,b,c] = pattern;
                if (board[a] === winner && board[b] === winner && board[c] === winner) {
                    pattern.forEach(index => {
                        document.querySelector(`.cell[data-index="${index}"]`).classList.add('winning-cell');
                    });
                    break;
                }
            }
        }

        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function newGame() {
            if (currentRoom) {
                database.ref('rooms/' + currentRoom + '/game').update({
                    board: ['','','','','','','','',''],
                    currentPlayer: 'X',
                    winner: null,
                    draw: false
                });
                document.getElementById('status').textContent = 'üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
            } else {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ –∫–æ–º–Ω–∞—Ç–µ!');
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyLink() {
            if (currentRoom) {
                const link = window.location.href.split('?')[0] + '?room=' + currentRoom;
                navigator.clipboard.writeText(link).then(() => {
                    alert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!\n\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥—É:\n' + link);
                });
            } else {
                alert('‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—É!');
            }
        }

        // –ê–≤—Ç–æ–ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ —Å—Å—ã–ª–∫–µ
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            if (roomId) {
                document.getElementById('roomInput').value = roomId;
                setTimeout(() => joinRoom(roomId, false), 1000);
            }
            createBoard();
        });
    </script>
</body>
</html>
